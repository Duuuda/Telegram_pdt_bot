
# Telegram bot with administration

> ## BOT CREATED BY
>* [Evgeniy Malyh](http://vk.com/evgeniymalyh)
>* [Vadim Tchunikhin](https://vk.com/duuuda)

## About the bot:

### The bot has a 3-button main keyboard and several commands.

1. Bot Information
> - More bot info

2. PDT response
> - Send a response about the work done by PDT users to all administrators

3. Promotion and earnings
> - The button is responsible for indicating the referral and the purchase of a subscription to the unique content of the group "promotion 's"
(If you already have a subscription, you will receive a message with the number of days until the end of the subscription)

![Main KeyBoard Bot](https://eastus1-mediap.svc.ms/transform/thumbnail?provider=spo&inputFormat=png&cs=fFNQTw&docid=https%3A%2F%2Fubest-my.sharepoint.com%3A443%2F_api%2Fv2.0%2Fdrives%2Fb!c5eMv7vE1k2iLHfTIYURoo4PUWrlt6pHmw1KwDQSjileLir_-bGYS5Ayy38uVvrx%2Fitems%2F01NZ3VFL7MORTCALTDPJFZ6TUPHEZGKA3E%3Fversion%3DPublished&access_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJub25lIn0.eyJhdWQiOiIwMDAwMDAwMy0wMDAwLTBmZjEtY2UwMC0wMDAwMDAwMDAwMDAvdWJlc3QtbXkuc2hhcmVwb2ludC5jb21AMDdhNjE5NDItZmQyYi00OGIzLTlkZTMtZTc4NDQxZTRkNmVlIiwiaXNzIjoiMDAwMDAwMDMtMDAwMC0wZmYxLWNlMDAtMDAwMDAwMDAwMDAwIiwibmJmIjoiMTU5MDM2NTQ5NyIsImV4cCI6IjE1OTAzODcwOTciLCJlbmRwb2ludHVybCI6ImxBYmdXN0QzdVE3NHZzcDIxRk83TWZQYXMyMi80enBINTQwbVN1Ky9lWVU9IiwiZW5kcG9pbnR1cmxMZW5ndGgiOiIxMTUiLCJpc2xvb3BiYWNrIjoiVHJ1ZSIsImNpZCI6Ik9EaGlOVFUxT1dZdFpqQXhNQzFpTURBd0xXRTFNalV0T0RJeU1tWmhPVE0xTWpJeCIsInZlciI6Imhhc2hlZHByb29mdG9rZW4iLCJzaXRlaWQiOiJZbVk0WXprM056TXRZelJpWWkwMFpHUTJMV0V5TW1NdE56ZGtNekl4T0RVeE1XRXkiLCJuYW1laWQiOiIwIy5mfG1lbWJlcnNoaXB8dXJuJTNhc3BvJTNhYW5vbiNmNTllZjhhY2I2OGM2MTM0YTc5YjMwY2U5ZDdiZDA5YTM4YTIwNDM5Y2IxN2ZhYjkxMjNiMTE2ZDE3ZDAwMTc2IiwibmlpIjoibWljcm9zb2Z0LnNoYXJlcG9pbnQiLCJpc3VzZXIiOiJ0cnVlIiwiY2FjaGVrZXkiOiIwaC5mfG1lbWJlcnNoaXB8dXJuJTNhc3BvJTNhYW5vbiNmNTllZjhhY2I2OGM2MTM0YTc5YjMwY2U5ZDdiZDA5YTM4YTIwNDM5Y2IxN2ZhYjkxMjNiMTE2ZDE3ZDAwMTc2Iiwic2hhcmluZ2lkIjoiR21QaHVrTE5Qa3VwK2lXS1VHRGxEUSIsInR0IjoiMCIsInVzZVBlcnNpc3RlbnRDb29raWUiOiIyIn0.bzZkNFpxWE8wd2VnNE5oWVB2dCtDZnVidUhDZ2YxSytjNGZLaGFrVnoyYz0&encodeFailures=1&srcWidth=&srcHeight=&width=588&height=136&action=Access)

4. Command ID
> 
> Target Command |
> -------------- |
>  /id           | 
> /get_id        |
> /get_self_id   | 
> The command returns a numeric value - your ID

### The appearance of the admin panel:

![Main Admin Panel](https://eastus1-mediap.svc.ms/transform/thumbnail?provider=spo&inputFormat=png&cs=fFNQTw&docid=https%3A%2F%2Fubest-my.sharepoint.com%3A443%2F_api%2Fv2.0%2Fdrives%2Fb!c5eMv7vE1k2iLHfTIYURoo4PUWrlt6pHmw1KwDQSjileLir_-bGYS5Ayy38uVvrx%2Fitems%2F01NZ3VFL62XF4N4XO5KNDLL7ZCWFUFVEAO%3Fversion%3DPublished&access_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJub25lIn0.eyJhdWQiOiIwMDAwMDAwMy0wMDAwLTBmZjEtY2UwMC0wMDAwMDAwMDAwMDAvdWJlc3QtbXkuc2hhcmVwb2ludC5jb21AMDdhNjE5NDItZmQyYi00OGIzLTlkZTMtZTc4NDQxZTRkNmVlIiwiaXNzIjoiMDAwMDAwMDMtMDAwMC0wZmYxLWNlMDAtMDAwMDAwMDAwMDAwIiwibmJmIjoiMTU5MDM2NTU1MCIsImV4cCI6IjE1OTAzODcxNTAiLCJlbmRwb2ludHVybCI6ImxBYmdXN0QzdVE3NHZzcDIxRk83TWZQYXMyMi80enBINTQwbVN1Ky9lWVU9IiwiZW5kcG9pbnR1cmxMZW5ndGgiOiIxMTUiLCJpc2xvb3BiYWNrIjoiVHJ1ZSIsImNpZCI6Ik9UUmlOVFUxT1dZdE1EQmxZUzFpTURBd0xUbGhNREl0TldKbE9XRTFaV1ZqTlRaayIsInZlciI6Imhhc2hlZHByb29mdG9rZW4iLCJzaXRlaWQiOiJZbVk0WXprM056TXRZelJpWWkwMFpHUTJMV0V5TW1NdE56ZGtNekl4T0RVeE1XRXkiLCJuYW1laWQiOiIwIy5mfG1lbWJlcnNoaXB8dXJuJTNhc3BvJTNhYW5vbiNmNTllZjhhY2I2OGM2MTM0YTc5YjMwY2U5ZDdiZDA5YTM4YTIwNDM5Y2IxN2ZhYjkxMjNiMTE2ZDE3ZDAwMTc2IiwibmlpIjoibWljcm9zb2Z0LnNoYXJlcG9pbnQiLCJpc3VzZXIiOiJ0cnVlIiwiY2FjaGVrZXkiOiIwaC5mfG1lbWJlcnNoaXB8dXJuJTNhc3BvJTNhYW5vbiNmNTllZjhhY2I2OGM2MTM0YTc5YjMwY2U5ZDdiZDA5YTM4YTIwNDM5Y2IxN2ZhYjkxMjNiMTE2ZDE3ZDAwMTc2Iiwic2hhcmluZ2lkIjoiR21QaHVrTE5Qa3VwK2lXS1VHRGxEUSIsInR0IjoiMCIsInVzZVBlcnNpc3RlbnRDb29raWUiOiIyIn0.OUZQZDNnaWVmQkhCTlZrUzNubFhEbEorQmp2WEV4aWNJR1NXL3RvYUs5OD0&encodeFailures=1&srcWidth=&srcHeight=&width=580&height=173&action=Access)

#### Manage Events:

![Admin manage event panel](https://eastus1-mediap.svc.ms/transform/thumbnail?provider=spo&inputFormat=png&cs=fFNQTw&docid=https%3A%2F%2Fubest-my.sharepoint.com%3A443%2F_api%2Fv2.0%2Fdrives%2Fb!c5eMv7vE1k2iLHfTIYURoo4PUWrlt6pHmw1KwDQSjileLir_-bGYS5Ayy38uVvrx%2Fitems%2F01NZ3VFLYWYZEIY3VYLVGY4XYGEYOA3YIU%3Fversion%3DPublished&access_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJub25lIn0.eyJhdWQiOiIwMDAwMDAwMy0wMDAwLTBmZjEtY2UwMC0wMDAwMDAwMDAwMDAvdWJlc3QtbXkuc2hhcmVwb2ludC5jb21AMDdhNjE5NDItZmQyYi00OGIzLTlkZTMtZTc4NDQxZTRkNmVlIiwiaXNzIjoiMDAwMDAwMDMtMDAwMC0wZmYxLWNlMDAtMDAwMDAwMDAwMDAwIiwibmJmIjoiMTU5MDM2NTcwNCIsImV4cCI6IjE1OTAzODczMDQiLCJlbmRwb2ludHVybCI6ImxBYmdXN0QzdVE3NHZzcDIxRk83TWZQYXMyMi80enBINTQwbVN1Ky9lWVU9IiwiZW5kcG9pbnR1cmxMZW5ndGgiOiIxMTUiLCJpc2xvb3BiYWNrIjoiVHJ1ZSIsImNpZCI6IlltRmlOVFUxT1dZdE9UQmhNQzFpTURBd0xXRTBOMlF0WmpZMk5tWmpaV0kxTlROaiIsInZlciI6Imhhc2hlZHByb29mdG9rZW4iLCJzaXRlaWQiOiJZbVk0WXprM056TXRZelJpWWkwMFpHUTJMV0V5TW1NdE56ZGtNekl4T0RVeE1XRXkiLCJuYW1laWQiOiIwIy5mfG1lbWJlcnNoaXB8dXJuJTNhc3BvJTNhYW5vbiNmNTllZjhhY2I2OGM2MTM0YTc5YjMwY2U5ZDdiZDA5YTM4YTIwNDM5Y2IxN2ZhYjkxMjNiMTE2ZDE3ZDAwMTc2IiwibmlpIjoibWljcm9zb2Z0LnNoYXJlcG9pbnQiLCJpc3VzZXIiOiJ0cnVlIiwiY2FjaGVrZXkiOiIwaC5mfG1lbWJlcnNoaXB8dXJuJTNhc3BvJTNhYW5vbiNmNTllZjhhY2I2OGM2MTM0YTc5YjMwY2U5ZDdiZDA5YTM4YTIwNDM5Y2IxN2ZhYjkxMjNiMTE2ZDE3ZDAwMTc2Iiwic2hhcmluZ2lkIjoiR21QaHVrTE5Qa3VwK2lXS1VHRGxEUSIsInR0IjoiMCIsInVzZVBlcnNpc3RlbnRDb29raWUiOiIyIn0.NTNlbTdnakRTVmsxd0FjTUo5aWhuZUwyRjhrR3l1WWZGYnBHc0NQMFJJOD0&encodeFailures=1&srcWidth=&srcHeight=&width=378&height=133&action=Access)

Command | Description
------- | -----------
Update Event | Create or update an existing event
Clean one Event | Clear one selected event 
Clean all events in day | Clear all events on the selected day
Clean ALL Events | Clear the entire database

##### Example update/add event:

> (Admin > Update Event)
> 
> After clicking on the Update Event button, the panel disappears and you enter the process of creating / updating an event
> 
> ![Example update/add event](https://eastus1-mediap.svc.ms/transform/thumbnail?provider=spo&inputFormat=png&cs=fFNQTw&docid=https%3A%2F%2Fubest-my.sharepoint.com%3A443%2F_api%2Fv2.0%2Fdrives%2Fb!c5eMv7vE1k2iLHfTIYURoo4PUWrlt6pHmw1KwDQSjileLir_-bGYS5Ayy38uVvrx%2Fitems%2F01NZ3VFL4CAU2ENCCD7VDIQKYTILJ7247H%3Fversion%3DPublished&access_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJub25lIn0.eyJhdWQiOiIwMDAwMDAwMy0wMDAwLTBmZjEtY2UwMC0wMDAwMDAwMDAwMDAvdWJlc3QtbXkuc2hhcmVwb2ludC5jb21AMDdhNjE5NDItZmQyYi00OGIzLTlkZTMtZTc4NDQxZTRkNmVlIiwiaXNzIjoiMDAwMDAwMDMtMDAwMC0wZmYxLWNlMDAtMDAwMDAwMDAwMDAwIiwibmJmIjoiMTU5MDM2NTc3NyIsImV4cCI6IjE1OTAzODczNzciLCJlbmRwb2ludHVybCI6ImxBYmdXN0QzdVE3NHZzcDIxRk83TWZQYXMyMi80enBINTQwbVN1Ky9lWVU9IiwiZW5kcG9pbnR1cmxMZW5ndGgiOiIxMTUiLCJpc2xvb3BiYWNrIjoiVHJ1ZSIsImNpZCI6IlkyTmlOVFUxT1dZdFl6QTNNUzFpTURBd0xXRTBOMlF0WmpJNE5EUmxZV1EzWXpoaiIsInZlciI6Imhhc2hlZHByb29mdG9rZW4iLCJzaXRlaWQiOiJZbVk0WXprM056TXRZelJpWWkwMFpHUTJMV0V5TW1NdE56ZGtNekl4T0RVeE1XRXkiLCJuYW1laWQiOiIwIy5mfG1lbWJlcnNoaXB8dXJuJTNhc3BvJTNhYW5vbiNmNTllZjhhY2I2OGM2MTM0YTc5YjMwY2U5ZDdiZDA5YTM4YTIwNDM5Y2IxN2ZhYjkxMjNiMTE2ZDE3ZDAwMTc2IiwibmlpIjoibWljcm9zb2Z0LnNoYXJlcG9pbnQiLCJpc3VzZXIiOiJ0cnVlIiwiY2FjaGVrZXkiOiIwaC5mfG1lbWJlcnNoaXB8dXJuJTNhc3BvJTNhYW5vbiNmNTllZjhhY2I2OGM2MTM0YTc5YjMwY2U5ZDdiZDA5YTM4YTIwNDM5Y2IxN2ZhYjkxMjNiMTE2ZDE3ZDAwMTc2Iiwic2hhcmluZ2lkIjoiR21QaHVrTE5Qa3VwK2lXS1VHRGxEUSIsInR0IjoiMCIsInVzZVBlcnNpc3RlbnRDb29raWUiOiIyIn0.czVhTVhianlPVVQxMVA3U0JMaExKeGh5SGh0MFN5MlhUNWVZQy9yRVNLMD0&encodeFailures=1&srcWidth=&srcHeight=&width=593&height=699&action=Access)


#### Manage User:
![Admin manage user panel](https://eastus1-mediap.svc.ms/transform/thumbnail?provider=spo&inputFormat=png&cs=fFNQTw&docid=https%3A%2F%2Fubest-my.sharepoint.com%3A443%2F_api%2Fv2.0%2Fdrives%2Fb!c5eMv7vE1k2iLHfTIYURoo4PUWrlt6pHmw1KwDQSjileLir_-bGYS5Ayy38uVvrx%2Fitems%2F01NZ3VFLZR2BUKXB3345EIJLLYXGQEI3KF%3Fversion%3DPublished&access_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJub25lIn0.eyJhdWQiOiIwMDAwMDAwMy0wMDAwLTBmZjEtY2UwMC0wMDAwMDAwMDAwMDAvdWJlc3QtbXkuc2hhcmVwb2ludC5jb21AMDdhNjE5NDItZmQyYi00OGIzLTlkZTMtZTc4NDQxZTRkNmVlIiwiaXNzIjoiMDAwMDAwMDMtMDAwMC0wZmYxLWNlMDAtMDAwMDAwMDAwMDAwIiwibmJmIjoiMTU5MDM2NTg0MSIsImV4cCI6IjE1OTAzODc0NDEiLCJlbmRwb2ludHVybCI6ImxBYmdXN0QzdVE3NHZzcDIxRk83TWZQYXMyMi80enBINTQwbVN1Ky9lWVU9IiwiZW5kcG9pbnR1cmxMZW5ndGgiOiIxMTUiLCJpc2xvb3BiYWNrIjoiVHJ1ZSIsImNpZCI6IlpHSmlOVFUxT1dZdE5EQm1OUzFpTURBd0xXRTFNVFV0WXpkaU9XRmtPRFZrT1RNeiIsInZlciI6Imhhc2hlZHByb29mdG9rZW4iLCJzaXRlaWQiOiJZbVk0WXprM056TXRZelJpWWkwMFpHUTJMV0V5TW1NdE56ZGtNekl4T0RVeE1XRXkiLCJuYW1laWQiOiIwIy5mfG1lbWJlcnNoaXB8dXJuJTNhc3BvJTNhYW5vbiNmNTllZjhhY2I2OGM2MTM0YTc5YjMwY2U5ZDdiZDA5YTM4YTIwNDM5Y2IxN2ZhYjkxMjNiMTE2ZDE3ZDAwMTc2IiwibmlpIjoibWljcm9zb2Z0LnNoYXJlcG9pbnQiLCJpc3VzZXIiOiJ0cnVlIiwiY2FjaGVrZXkiOiIwaC5mfG1lbWJlcnNoaXB8dXJuJTNhc3BvJTNhYW5vbiNmNTllZjhhY2I2OGM2MTM0YTc5YjMwY2U5ZDdiZDA5YTM4YTIwNDM5Y2IxN2ZhYjkxMjNiMTE2ZDE3ZDAwMTc2Iiwic2hhcmluZ2lkIjoiR21QaHVrTE5Qa3VwK2lXS1VHRGxEUSIsInR0IjoiMCIsInVzZVBlcnNpc3RlbnRDb29raWUiOiIyIn0.Z2c1MDBBamRFL3dkLytYVHRzbUxreXppN1BkTDAyM0Y2WXdJeVlzdDB2az0&encodeFailures=1&srcWidth=&srcHeight=&width=401&height=178&action=Access)

Command | Description
------- | -----------
Update user | User permission update
Show admins | Show list of users in admin group
Show PDTs  | Show list of users in PDT group
Show promos | Show list of users in Promotion group
Show ALL users | Show full list of users


##### Example update user:

> (Admin > Update User)
> 
> After clicking on the Update User button, the panel disappears and you enter the process of updating / adding a user. Another panel will appear in which you can choose to update or delete a user
> 
> ![Example update user](https://eastus1-mediap.svc.ms/transform/thumbnail?provider=spo&inputFormat=png&cs=fFNQTw&docid=https%3A%2F%2Fubest-my.sharepoint.com%3A443%2F_api%2Fv2.0%2Fdrives%2Fb!c5eMv7vE1k2iLHfTIYURoo4PUWrlt6pHmw1KwDQSjileLir_-bGYS5Ayy38uVvrx%2Fitems%2F01NZ3VFL3WUGPHLE4MTBELCUEYAVPNKWLH%3Fversion%3DPublished&access_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJub25lIn0.eyJhdWQiOiIwMDAwMDAwMy0wMDAwLTBmZjEtY2UwMC0wMDAwMDAwMDAwMDAvdWJlc3QtbXkuc2hhcmVwb2ludC5jb21AMDdhNjE5NDItZmQyYi00OGIzLTlkZTMtZTc4NDQxZTRkNmVlIiwiaXNzIjoiMDAwMDAwMDMtMDAwMC0wZmYxLWNlMDAtMDAwMDAwMDAwMDAwIiwibmJmIjoiMTU5MDM2NTg4OCIsImV4cCI6IjE1OTAzODc0ODgiLCJlbmRwb2ludHVybCI6ImxBYmdXN0QzdVE3NHZzcDIxRk83TWZQYXMyMi80enBINTQwbVN1Ky9lWVU9IiwiZW5kcG9pbnR1cmxMZW5ndGgiOiIxMTUiLCJpc2xvb3BiYWNrIjoiVHJ1ZSIsImNpZCI6IlpUZGlOVFUxT1dZdFpUQTJaUzFpTURBd0xXRTFNalV0T0RGallqVXhNR1UzWXpRNCIsInZlciI6Imhhc2hlZHByb29mdG9rZW4iLCJzaXRlaWQiOiJZbVk0WXprM056TXRZelJpWWkwMFpHUTJMV0V5TW1NdE56ZGtNekl4T0RVeE1XRXkiLCJuYW1laWQiOiIwIy5mfG1lbWJlcnNoaXB8dXJuJTNhc3BvJTNhYW5vbiNmNTllZjhhY2I2OGM2MTM0YTc5YjMwY2U5ZDdiZDA5YTM4YTIwNDM5Y2IxN2ZhYjkxMjNiMTE2ZDE3ZDAwMTc2IiwibmlpIjoibWljcm9zb2Z0LnNoYXJlcG9pbnQiLCJpc3VzZXIiOiJ0cnVlIiwiY2FjaGVrZXkiOiIwaC5mfG1lbWJlcnNoaXB8dXJuJTNhc3BvJTNhYW5vbiNmNTllZjhhY2I2OGM2MTM0YTc5YjMwY2U5ZDdiZDA5YTM4YTIwNDM5Y2IxN2ZhYjkxMjNiMTE2ZDE3ZDAwMTc2Iiwic2hhcmluZ2lkIjoiR21QaHVrTE5Qa3VwK2lXS1VHRGxEUSIsInR0IjoiMCIsInVzZVBlcnNpc3RlbnRDb29raWUiOiIyIn0.VngxWk43UTNhc2g3cjh6TDgzWnNLTllSRkQvUFZwdGxGb01DSTltdUdjUT0&encodeFailures=1&srcWidth=&srcHeight=&width=583&height=462&action=Access)

## Install:

### Part 1: Installing the necessary libraries for the bot to work

Open the console and install the specified libraries
```
pip install pytelegrambotapi
pip install SQLAlchemy
pip install pysocks
```

### Part 2: Register a bot in BotFather
Very short: Go to the @BotFather bot, send him the `/start` command, after `/newbot`
1. Go to the @BotFather bot
2. Send him command `/start`
3. After `/newbot`
3. Choose a name for your bot.

After completing registration, he will send you a message which will contain your token for controlling the bot. Save it. He will be needed later.
	
    Token is the only key for authorizing the bot and interacting with it.
    
Also, to give ourselves superuser rights, we need to find out our ID. This can be done by writing the bot in a telegram [@userinfobot](https://telegram.me/userinfobot)

### Part 3: Connecting your payment system

1. We go again to the @BotFather bot
2. Choose a bot from the list
3. Choise "Payments"
4. Finally, select your payment system from the list provided and follow the instructions of this payment system

After completion, you will have payment providers token. Save it. He will be needed later.

### Part 4: Editing bot settings in the config

Open config.json and change the following values:
```
{
  "TOKEN": "enter your bot token",
  "super_admin_id": <enter your id>,
  "PAYMENTS_PROVIDER_TOKEN": "enter your payment providers token",
  "PROMOTION_SUBSCRIPTION_TITLE": "enter your name subscription",
  "PROMOTION_SUBSCRIPTION_DESCRIPTION": "enter your description to subscription",
  "PRICE": "enter your price"
}
```
	Please note! The price in this example is in RUB
    (The minimum value in RUB that can be specified is ~72 rubles)
	Example: 100 rubles
    In "PRICE" you will have to write - 10000 (100 rubles and 00 kopecks) # 100.00
> `"PRICE": "10000"`
    
### Part 5: Bot launch

The bot is launched through the `main.py` file

Open a terminal and go to the folder with the bot and run the command
`python main.py` or `python3 main.py`

>If telegrams are blocked in your country:
>
>1. Go to the folder `Bot`
>2. Open the file `bot.py` and find the line `apihelper.proxy =`
>3. Uncomment her
>4. Change the `IP:PORT` value in the line `apihelper.proxy = {'https': 'socks5://IP:PORT'}`
>5. You can take free proxies on this site
> http://free-proxy.cz/ru/proxylist/country/all/socks5/ping/all
---
> 
